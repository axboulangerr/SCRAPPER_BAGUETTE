# =================================================================
# SCRIPT GRAB COMPLEXE - DÉMONSTRATION COMPLÈTE DU LANGAGE
# =================================================================
# Ce script démontre toutes les fonctionnalités du DSL GrabLang
# Date: 31 octobre 2025

# =================================================================
# 1. CHARGEMENT DE DONNÉES MULTIPLES
# =================================================================

# Charge plusieurs sites dans des variables nommées
LOAD URL openai "https://openai.com"
LOAD URL deepmind "https://deepmind.google/discover/blog/"
LOAD URL httpbin "https://httpbin.org/html"

# Affichage des pages chargées
PRINT openai
PRINT deepmind
PRINT httpbin

# =================================================================
# 2. ANALYSE APPROFONDIE AVEC MODE DÉVELOPPEUR
# =================================================================

# Analyse détaillée des structures
PRINT DEV openai
PRINT DEV deepmind

# =================================================================
# 3. SÉLECTION ET FILTRAGE AVANCÉS
# =================================================================

# Travail avec OpenAI
USE openai

# Sélection de tous les liens
SELECT ALL "a"
SAVE all_openai_links
PRINT all_openai_links

# Filtrage de tous les liens avec href
FILTER ALL WHERE attr href NOT NULL
SAVE valid_links_openai
PRINT DEV valid_links_openai

# Premier lien valide
USE all_openai_links
FILTER FIRST WHERE attr href CONTAINS "http"
SAVE first_external_link
PRINT DEV first_external_link

# Dernier élément avec classe spécifique
SELECT ALL "div"
FILTER LAST WHERE class CONTAINS "nav"
SAVE last_nav_div
PRINT last_nav_div

# Sélection d'un élément spécifique par index
SELECT ALL "span"
FILTER ONCE 3 WHERE text MATCHES ".+"
SAVE third_span_with_text
PRINT third_span_with_text

# =================================================================
# 4. EXTRACTION D'ATTRIBUTS MULTIPLES
# =================================================================

# Basculer vers DeepMind pour plus de contenu
USE deepmind

# Extraction d'attributs des liens
SELECT ALL "a"
FILTER ALL WHERE attr href NOT NULL
SAVE deepmind_links

# Récupération du premier href
GET ATTR_FIRST href FROM deepmind_links
SAVE first_deepmind_href
PRINT first_deepmind_href

# Récupération du dernier href
GET ATTR_LAST href FROM deepmind_links
SAVE last_deepmind_href
PRINT last_deepmind_href

# Récupération d'un href spécifique
GET ATTR_ONCE 5 href FROM deepmind_links
SAVE fifth_deepmind_href
PRINT fifth_deepmind_href

# Récupération de tous les hrefs
GET ATTR href FROM deepmind_links
SAVE all_deepmind_hrefs
PRINT DEV all_deepmind_hrefs

# =================================================================
# 5. EXTRACTION DE DATES COMPLEXES
# =================================================================

# Recherche d'éléments avec des dates
SELECT ALL "time"
SAVE time_elements
PRINT DEV time_elements

# Si pas d'éléments time, chercher dans les spans et divs
SELECT ALL "span"
FILTER ALL WHERE text MATCHES "[0-9]{4}"
SAVE elements_with_years
PRINT elements_with_years

# Extraction des premières dates trouvées
GET DATE_FIRST FROM elements_with_years
SAVE first_date_found
PRINT first_date_found

# =================================================================
# 6. SÉLECTIONS AVANCÉES AVEC DIFFÉRENTS SÉLECTEURS
# =================================================================

# Retour sur DeepMind pour analyses complètes
USE deepmind

# Premier div
SELECT FIRST "div"
SAVE first_div
PRINT DEV first_div

# Dernier paragraphe
SELECT LAST "p"
SAVE last_paragraph
PRINT DEV last_paragraph

# Élément spécifique par index
SELECT ONCE 10 "img"
SAVE tenth_image
PRINT tenth_image

# =================================================================
# 7. CHAÎNAGE D'OPÉRATIONS COMPLEXES
# =================================================================

# Séquence complexe: navigation → sélection → filtrage → extraction
USE deepmind

# Trouve tous les articles ou contenus principaux
SELECT ALL "article"
SAVE articles
PRINT articles

# Si pas d'articles, chercher des divs avec classes spécifiques
SELECT ALL "div"
FILTER ALL WHERE class CONTAINS "content"
SAVE content_divs
PRINT content_divs

# Extraction des titres depuis les content_divs
USE content_divs
SELECT ALL "h1, h2, h3"
SAVE content_titles
PRINT DEV content_titles

# Premier titre avec du texte
FILTER FIRST WHERE text MATCHES ".+"
SAVE first_real_title
PRINT first_real_title

# =================================================================
# 8. GESTION D'ERREURS ET CAS LIMITES
# =================================================================

# Test avec httpbin (structure simple)
USE httpbin

# Sélection sur une page simple
SELECT ALL "p"
SAVE simple_paragraphs
PRINT simple_paragraphs

# Test de filtrage sur peu d'éléments
FILTER ALL WHERE text CONTAINS "test"
SAVE test_paragraphs
PRINT test_paragraphs

# =================================================================
# 9. EXTRACTION MASSIVE DE DONNÉES
# =================================================================

# Retour sur DeepMind pour extraction complète
USE deepmind

# Extraction de tous les liens de navigation
SELECT ALL "nav a"
SAVE nav_links
PRINT DEV nav_links

# Tous les attributs href des liens de navigation
GET ATTR href FROM nav_links
SAVE nav_hrefs
PRINT nav_hrefs

# Extraction de toutes les images
SELECT ALL "img"
SAVE all_images
PRINT all_images

# Sources de toutes les images
GET ATTR src FROM all_images
SAVE image_sources
PRINT DEV image_sources

# Textes alternatifs des images
GET ATTR alt FROM all_images
SAVE image_alts
PRINT image_alts

# =================================================================
# 10. COMBINAISONS AVANCÉES DE FILTRES
# =================================================================

# Recherche d'éléments avec classes multiples
SELECT ALL "div"
FILTER ALL WHERE class CONTAINS "flex"
SAVE flex_divs
PRINT flex_divs

# Parmi les flex divs, ceux avec du texte
FILTER ALL WHERE text MATCHES ".+"
SAVE flex_divs_with_text
PRINT DEV flex_divs_with_text

# Premier flex div avec beaucoup de texte
FILTER FIRST WHERE text MATCHES ".{50,}"
SAVE first_long_text_flex
PRINT first_long_text_flex

# =================================================================
# 11. VÉRIFICATIONS ET TESTS DE ROBUSTESSE
# =================================================================

# Test de variables inexistantes (géré par le système)
PRINT DEV all_deepmind_hrefs
PRINT DEV image_sources
PRINT DEV flex_divs_with_text

# =================================================================
# 12. RÉCAPITULATIF FINAL
# =================================================================

# Affichage de toutes les variables importantes créées
PRINT openai
PRINT deepmind
PRINT all_openai_links
PRINT valid_links_openai
PRINT deepmind_links
PRINT all_deepmind_hrefs
PRINT content_titles
PRINT nav_links
PRINT all_images
PRINT flex_divs_with_text

# =================================================================
# FIN DU SCRIPT COMPLEXE
# =================================================================
# Variables créées: 20+
# Pages analysées: 3 (OpenAI, DeepMind, HTTPBin)
# Commandes utilisées: LOAD URL, USE, SELECT (ALL/FIRST/LAST/ONCE), 
#                      FILTER (ALL/FIRST/LAST/ONCE), GET (ATTR/DATE),
#                      SAVE, PRINT, PRINT DEV
# Opérations: 60+ lignes de traitement
# =================================================================