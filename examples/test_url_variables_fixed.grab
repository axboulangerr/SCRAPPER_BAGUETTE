# Script final qui démontre LOAD URL avec des variables
PRINT "=== Test final: LOAD URL avec variables ==="

# Charger example.com et voir ce qu'on trouve
LOAD URL "https://example.com"
SELECT ALL "a"
GET ATTR "href"
SAVE links

PRINT "Liens trouvés:"
PRINT links

# Traiter chaque lien trouvé
FOR link IN links {
    PRINT "Lien en cours de traitement:"
    PRINT link
    
    # Tester si c'est une URL complète
    IF link CONTAINS "http" {
        PRINT "✅ URL complète détectée, chargement..."
        
        # VOICI LA FONCTIONNALITÉ DEMANDÉE : charger depuis une variable
        LOAD URL page_from_variable link
        USE page_from_variable
        
        SELECT FIRST "title"
        GET TEXT
        SAVE title_from_variable
        
        PRINT "✅ Page chargée depuis la variable 'link'!"
        PRINT "Titre de la page:"
        PRINT title_from_variable
        
        BREAK
    }
}

# Test avec création explicite d'une variable URL
PRINT "=== Test avec variable créée explicitement ==="

# Simuler la création d'une variable URL (approche manuelle)
FOR i IN RANGE 1 {
    # Dans une vraie application, cette URL viendrait d'une extraction
    # Ici on simule en créant la variable dans le contexte de la boucle
    LOAD URL test "https://httpbin.org/get"
    
    # Maintenant on a 'test' comme page chargée
    # Créons une variable URL pour tester
    EXTRACT REGEX "httpbin\.org"
    SAVE domain_found
    
    IF domain_found NOT EMPTY {
        PRINT "Domaine trouvé, test avec URL de variable..."
        
        # Créer une URL de test (simulation)
        FOR url_test IN links {
            # Utiliser le premier lien disponible
            PRINT "Test avec:"
            PRINT url_test
            
            # Charge depuis la variable url_test
            LOAD URL result_page url_test
            
            PRINT "✅ Chargement réussi depuis la variable!"
            BREAK
        }
    }
}

PRINT "=== Fonctionnalité validée! ==="
PRINT "LOAD URL variable_name url_variable fonctionne correctement!"